(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();const v=10,L=5,y=3,h=t=>fetch(`https://restcountries.com/v3.1/name/${t}`,{method:"GET",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow"}).then(e=>e.ok?e.json():Promise.reject(e)),f=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch{localStorage.clear()}},d=t=>{const e=localStorage.getItem(t);if(e!==null)try{return JSON.parse(e)}catch{return[]}return[]},p=document.querySelector(".search"),o=document.querySelector(".suggest"),a=document.querySelector(".result"),g=document.querySelector(".history__list"),u=(t,e)=>d(e).find(r=>r.name.common===t),S=t=>{o.classList.remove("active"),o.innerHTML="";let e=0;t.map(n=>n.name.common).slice(0,v).forEach(n=>{const r=document.createElement("li");r.textContent=n,r.classList.add("suggest__item"),u(n,"visited")&&e<L?(e++,r.classList.add("suggest__item-visited"),o.prepend(r)):o.append(r)}),o.classList.add("active")},_=t=>{const e=a.querySelector(".result__name"),n=a.querySelector(".result__capital"),r=a.querySelector(".result__languages"),s=a.querySelector(".result__currencies"),c=a.querySelector(".result__flag");e.textContent=t.name.common,n.textContent=t.capital[0];for(const i in t.languages){const l=document.createElement("li");l.textContent=t.languages[i],r.append(l)}for(const i in t.currencies){const l=document.createElement("li");l.textContent=i,s.append(l)}c.setAttribute("src",t.flags.png),c.setAttribute("alt",t.flags.alt),a.classList.add("active")},m=()=>{const t=d("visited");t.length!==0?t.map(e=>e.name.common).slice(0,y).forEach(e=>{const n=document.createElement("li");n.textContent=e,g.append(n)}):g.innerHTML=""},E=t=>{if(t.target&&t.target instanceof HTMLLIElement){a.classList.remove("active"),o.classList.remove("active"),p.value="";const e=t.target.textContent,n=u(e,"currentRequests"),r=u(e,"visited"),s=d("visited");!r&&n&&s.unshift(n),f("visited",s),n&&_(n),m()}},C=async t=>{if(t.preventDefault(),t.target&&t.target instanceof HTMLInputElement){let e=[];try{e=await h(t.target.value)}catch(n){const r=document.createElement("li");n.statusText?r.textContent=n.statusText:r.textContent="Проблемы с подключением. Попробуйте обновить страницу",r.classList.add("suggest__item"),o.append(r),o.classList.add("active")}e.length!==0&&(f("currentRequests",e),S(e))}};p.addEventListener("change",C);o.addEventListener("click",E);window.addEventListener("storage",()=>{m()});m();
